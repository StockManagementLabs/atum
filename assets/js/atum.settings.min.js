(function($,window,document,undefined){"use strict";var pluginName="atumSettings",defaults={};function Plugin(element,options){this.$settingsWrapper=$(element);this.$nav=this.$settingsWrapper.find(".atum-nav");this.$form=this.$settingsWrapper.find("#atum-settings");this.settings=$.extend({},defaults,atumSettingsVars||{},options||{});this._defaults=defaults;this._name=pluginName;this.init()}$.extend(Plugin.prototype,{navigationReady:false,numHashParameters:0,init:function(){var self=this;this.setupNavigation();this.doSwitchers();this.restoreEnhancedSelects();this.$form.on("change","input, select, textarea",function(){if(!$(".atum-nav-link.active").parent().hasClass("no-submit")){$(this).addClass("dirty")}}).on("click","input[type=submit]",function(){self.$form.find(".dirty").removeClass("dirty")}).on("click",".script-runner button",function(){self.runScript($(this))}).on("change","#atum_same_ship_address",function(){var $shippingSection=$("#atum_setting_shipping");if(this.checked){$shippingSection.slideUp()}else{$shippingSection.slideDown()}}).find("#atum_same_ship_address").change().removeClass("dirty");$(window).bind("beforeunload",function(){if(!self.$form.find(".dirty").length){return}if(navigator.userAgent.toLowerCase().match(/msie|chrome/)){if(window.aysHasPrompted){return}window.aysHasPrompted=true;window.setTimeout(function(){window.aysHasPrompted=false},900)}return false})},doSwitchers:function(){$(".js-switch").each(function(){new Switchery(this,{size:"small"})})},doNiceSelects:function(){},restoreEnhancedSelects:function(){$(".select2-container--open").remove();$("body").trigger("wc-enhanced-select-init")},setupNavigation:function(){if(typeof $.address==="undefined"){return}var self=this;$.address.change(function(event){var pathNames=$.address.pathNames(),numCurrentParams=pathNames.length;if(self.navigationReady===true&&(numCurrentParams||self.numHashParameters!==numCurrentParams)){self.clickTab(pathNames[0])}self.navigationReady=true}).init(function(){var pathNames=$.address.pathNames();if(pathNames.length){self.clickTab(pathNames[0])}else{self.$form.show()}})},clickTab:function(tab){var self=this,$navLink=this.$nav.find('.atum-nav-link[data-tab="'+tab+'"]');if(this.$form.find(".dirty").length){swal({title:this.settings.areYouSure,text:this.settings.unsavedData,type:"warning",showCancelButton:true,confirmButtonText:this.settings.continue,cancelButtonText:this.settings.cancel,reverseButtons:true,allowOutsideClick:false}).then(function(){self.moveToTab($navLink)},function(dismiss){$navLink.blur()})}else{self.moveToTab($navLink)}},moveToTab:function($navLink){var self=this,$formSettingsWrapper=this.$form.find(".form-settings-wrapper");this.$nav.find(".atum-nav-link.active").not($navLink).removeClass("active");$navLink.addClass("active");$formSettingsWrapper.addClass("overlay");this.$form.load($navLink.attr("href")+" .form-settings-wrapper",function(){self.doSwitchers();self.restoreEnhancedSelects();self.$form.show().find("#atum_same_ship_address").change().removeClass("dirty");var $inputButton=self.$form.find("input:submit");if($navLink.parent().hasClass("no-submit")){$inputButton.hide()}else{$inputButton.show()}})},runScript:function($button){var self=this,$scriptRunner=$button.closest(".script-runner");swal({title:this.settings.areYouSure,text:$scriptRunner.data("confirm"),type:"warning",showCancelButton:true,confirmButtonText:this.settings.run,cancelButtonText:this.settings.cancel,reverseButtons:true,allowOutsideClick:false,showLoaderOnConfirm:true,preConfirm:function(){return new Promise(function(resolve,reject){var $select=$button.siblings("select"),data={action:$scriptRunner.data("action"),token:self.settings.runnerNonce};if($select.length){data.option=$select.val()}$.ajax({url:ajaxurl,method:"POST",dataType:"json",data:data,beforeSend:function(){$button.prop("disabled",true)},success:function(response){$button.prop("disabled",false);if(response.success===true){resolve(response.data)}else{reject(response.data)}}})})}}).then(function(message){swal({title:self.settings.done,type:"success",text:message,confirmButtonText:self.settings.ok})}).catch(swal.noop)}});$.fn[pluginName]=function(options){return this.each(function(){if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new Plugin(this,options))}})};$(function(){$(".atum-settings-wrapper").atumSettings()})})(jQuery,window,document);