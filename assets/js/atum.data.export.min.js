(function($,window,document){"use strict";var pluginName="atumDataExport",defaults={};function Plugin(element,options){this.element=element;this.settings=$.extend({},defaults,options);this._defaults=defaults;this._name=pluginName;this.init()}$.extend(Plugin.prototype,{init:function(){var self=this;this.$tabContentWrapper=$("#screen-meta");this.$tabsWrapper=$("#screen-meta-links");this.createExportTab();$(this.element).on("submit","#atum-export-settings",function(e){e.preventDefault();var $exportForm=$(this),outputFormat=$exportForm.find('input[name="output-format"]:checked').val();if(!outputFormat||outputFormat===undefined){alert(atumExport.chooseFormat)}else{self.downloadReport()}})},createExportTab:function(){var $tab=this.$tabsWrapper.find("#screen-options-link-wrap").clone(),$tabContent=this.$tabContentWrapper.find("#screen-options-wrap").clone();$tabContent.attr({id:"atum-export-wrap","aria-label":atumExport.tabTitle});$tabContent.find("form").attr("id","atum-export-settings");$tabContent.find(".screen-options").remove();$tabContent.find("input[type=submit]").val(atumExport.submitTitle);var $typeFieldset=$('<fieldset class="product-type" />');$typeFieldset.append("<legend>"+atumExport.productTypesTitle+"</legend>");$typeFieldset.append(atumExport.productTypes);$typeFieldset.insertAfter($tabContent.find("fieldset").last());var $formatFieldset=$('<fieldset class="output-format" />');$formatFieldset.append("<legend>"+atumExport.outputFormatTitle+"</legend>");$.each(atumExport.outputFormats,function(key,value){$formatFieldset.append('<label><input type="radio" name="output-format" value="'+key+'">'+value+"</label>")});$formatFieldset.insertAfter($tabContent.find("fieldset").last());$tab.attr("id","atum-export-link-wrap").find("button").attr({id:"show-export-settings-link","aria-controls":"atum-export-wrap"}).text(atumExport.tabTitle);this.$tabContentWrapper.append($tabContent);this.$tabsWrapper.prepend($tab);$("#show-export-settings-link").click(screenMeta.toggleEvent)},downloadReport:function(){window.open(ajaxurl+"?action=atum_export_data&token="+atumExport.exportNonce,"_blank")}});$.fn[pluginName]=function(options){return this.each(function(){if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new Plugin(this,options))}})};$(function(){$("#wpbody-content").atumDataExport()})})(jQuery,window,document);jQuery.noConflict();